window = {
	name = "sabbat_view"
	datacontext = "[GetVariableSystem]"
	datacontext = "[GetPlayer]"
	parentanchor = top|right
	allow_outside = yes
	movable = no
	layer = windows_layer
	
	visible = "[And(And(GetVariableSystem.HasValue('pod_sidebar', 'sabbat'), Not(IsRightWindowOpen)), IsSidebarVisibilityValid)]"
	datacontext = "[GetReligionByKey( 'sabbat_religion' )]"
	datacontext = "[GetPlayer.GetFaith]"

	using = Window_Size_MainTab

	state = {
		name = _show
		using = Animation_FadeIn_Quick
		using = Sound_WindowShow_Standard
		using = Window_Position_MainTab

		on_start = "[GetVariableSystem.Set('sabbat_tab_choice','cardinals')]"
	}

	state = {
		name = _hide
		using = Animation_FadeOut_Quick
		using = Sound_WindowHide_Standard
		using = Window_Position_MainTab_Hide
	}

	margin_widget = {
		size = { 100% 100% }
		margin = { 0 26 }
		margin_right = 13

		widget = {
			size = { 100% 100% }

			### WINDOW CONTENT
			vbox = {
				using = Window_Margins
				ignoreinvisible = yes

				##### HEADER TEXT #####
				widget_header_with_picture = {
					layoutpolicy_horizontal = expanding
					minimumsize = { 0 180 }
					visible = "[Not(GreaterThan_int32( GetDataModelSize(Religion.MakeScope.GetList('member_clan')), '(int32)9' ))]"

					blockoverride "header_text" {
						text = "sabbat_religion"
					}

					blockoverride "size" {
						size = { 100% 198 }
					}

					blockoverride "illustration_texture" {
						texture = "gfx/interface/illustrations/window_headers/header_sects.dds"

						using = Mask_Rough_Edges

						modify_texture = {
							texture = "gfx/interface/component_masks/mask_fade_vertical.dds"
							blend_mode = alphamultiply
							mirror = vertical
						}
					}

					blockoverride "button_close"
					{
						onclick = "[GetVariableSystem.Clear('pod_sidebar')]"
						onclick = "[GetVariableSystem.Clear('sabbat_tab_choice')]"
					}

					vbox = {
						margin_top = 42
						margin_bottom = 10

						hbox = {
							spacing = 20

							text_single = {
								text = "SABBAT_WINDOW_MY_STATUS"
							}

							text_single = {
								text = "SABBAT_WINDOW_REGION_STATUS"
							}
						}

						hbox = {
							layoutpolicy_horizontal = expanding
							margin_top = 12
							margin_left = 10
							margin_right = 10
							spacing = 15
							
							vbox = {
								layoutpolicy_vertical = expanding
								ignoreinvisible = yes
								spacing = 3

								text_label_center = {
									text = "SABBAT_WINDOW_MEMBER_CLAN"
								}

								hbox = {
									datamodel = "[Religion.MakeScope.GetList('member_clan')]"

									background = {
										texture = "gfx/lines/line_lifestyles_unavailable.dds"
										margin = { -8 -12 }
										tintcolor = { 0.7 0.5 0.25 1 }
									}
									
									item = {
										icon_button_decorative = {
											size = { 60 60 }
											datacontext = "[Scope.FaithDoctrine]"
											tooltip = "FAITH_WINDOW_DOCTRINE_TOOLTIP_WITH_FAITH"
											using = tooltip_below

											icon_button_decorative = {
												size = { 54 54 }
												parentanchor = center
												alwaystransparent = yes
											}

											button_icon = {
												texture = "[Scope.FaithDoctrine.GetGroup.GetIcon]"
												parentanchor = center
												size = { 36 36 }
												alwaystransparent = yes

												# using = Master_Button_Modify_Texture

												# blockoverride "master_color_frame" {
													# frame = 1
												# }
											}
										}
									}
								}
							}
						}

						expand = {}
					}

					widget = {
						allow_outside = yes
						size = { 89 98 }

						sect_symbol_big = {
							parentanchor = top|hcenter
							position = { 5 5 }
							blockoverride "symbol" { texture = "gfx/interface/icons/Symbol_Sect_Sab.dds" }
						}
					}
				}
			
				##### HEADER TEXT 2 #####
				widget_header_with_picture = {
					layoutpolicy_horizontal = expanding
					minimumsize = { 0 210 }
					visible = "[GreaterThan_int32( GetDataModelSize(Religion.MakeScope.GetList('member_clan')), '(int32)9' )]"

					blockoverride "header_text" {
						text = "sabbat_religion"
					}

					blockoverride "size" {
						size = { 100% 228 }
					}

					blockoverride "illustration_texture" {
						texture = "gfx/interface/illustrations/window_headers/header_sects.dds"

						using = Mask_Rough_Edges

						modify_texture = {
							texture = "gfx/interface/component_masks/mask_fade_vertical.dds"
							blend_mode = alphamultiply
							mirror = vertical
						}
					}

					blockoverride "button_close"
					{
						onclick = "[GetVariableSystem.Clear('pod_sidebar')]"
						onclick = "[GetVariableSystem.Clear('sabbat_tab_choice')]"
					}

					vbox = {
						margin_top = 42
						margin_bottom = 10

						hbox = {
							spacing = 20

							text_single = {
								text = "SABBAT_WINDOW_MY_STATUS"
							}

							text_single = {
								text = "SABBAT_WINDOW_REGION_STATUS"
							}
						}

						hbox = {
							layoutpolicy_horizontal = expanding
							margin_top = 12
							margin_left = 10
							margin_right = 10
							spacing = 15
							
							vbox = {
								layoutpolicy_vertical = expanding
								ignoreinvisible = yes
								spacing = 3

								text_label_center = {
									text = "SABBAT_WINDOW_MEMBER_CLAN"
								}

								dynamicgridbox = {
									datamodel = "[Religion.MakeScope.GetList('member_clan')]"
									flipdirection = no
									datamodel_wrap = 2
									
									item = {
										icon_button_decorative = {
											size = { 50 50 }
											datacontext = "[Scope.FaithDoctrine]"
											tooltip = "FAITH_WINDOW_DOCTRINE_TOOLTIP_WITH_FAITH"
											using = tooltip_below

											icon_button_decorative = {
												size = { 44 44 }
												parentanchor = center
												alwaystransparent = yes
											}

											button_icon = {
												texture = "[Scope.FaithDoctrine.GetGroup.GetIcon]"
												parentanchor = center
												size = { 32 32 }
												alwaystransparent = yes

												# using = Master_Button_Modify_Texture

												# blockoverride "master_color_frame" {
													# frame = 1
												# }
											}
										}
									}
								}
							}
						}

						expand = {}
					}

					widget = {
						allow_outside = yes
						size = { 89 98 }

						sect_symbol_big = {
							parentanchor = top|hcenter
							position = { 5 5 }
							blockoverride "symbol" { texture = "gfx/interface/icons/Symbol_Sect_Sab.dds" }
						}
					}
				}
				
				hbox = {
					name = "sabbat_tabs"
					layoutpolicy_horizontal = expanding

					button_tab = {
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding
						onclick = "[GetVariableSystem.Set('sabbat_tab_choice','cardinals')]"
						down = "[GetVariableSystem.HasValue('sabbat_tab_choice', 'cardinals')]"

						text = "SABBAT_WINDOW_TAB_CARDINALS"
					}

					button_tab = {
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding
						onclick = "[GetVariableSystem.Set('sabbat_tab_choice','black_hand')]"
						down = "[GetVariableSystem.HasValue('sabbat_tab_choice', 'black_hand')]"

						text = "SABBAT_WINDOW_TAB_BLACK_HAND"
					}
				}
				
				### CARDINALS TAB
				vbox = {
					name = "tab_cardinals"
					visible = "[GetVariableSystem.HasValue('sabbat_tab_choice', 'cardinals')]"
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding

					using = Animation_Tab_Switch
					
					background = {
						name = "triangle_background"
						texture = "gfx/interface/illustrations/event_scenes/throneroom_west.dds"
						fittype = end
						alpha = 0.4
						framesize = { 1200 848 }

						using = Mask_Rough_Edges

						modify_texture = {
							texture = "gfx/interface/component_masks/mask_fade_vertical.dds"
							blend_mode = alphamultiply
							mirror = vertical
						}
					}
					
					scrollbox = {
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding

						blockoverride "scrollbox_margins" {
							margin = { 4 4 }
						}

						blockoverride "scrollbox_content"
						{
							fixedgridbox = {
								layoutpolicy_horizontal = expanding
								datamodel = "[Religion.MakeScope.GetList('cardinals')]"
								addcolumn = 545
								addrow = 120
								setitemsizefromcell = yes

								item = {
									widget_sect_member_item = {
										datacontext = "[Scope.GetCharacter]"
									}
								}
							}
							expand = {}
						}
					}
				}
				
				### BLACKHAND TAB
				vbox = {
					name = "tab_black_hand"
					visible = "[GetVariableSystem.HasValue('sabbat_tab_choice', 'black_hand')]"
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding

					using = Animation_Tab_Switch
					
					background = {
						name = "triangle_background"
						texture = "gfx/interface/illustrations/event_scenes/throneroom_west.dds"
						fittype = end
						alpha = 0.4
						framesize = { 1200 848 }

						using = Mask_Rough_Edges

						modify_texture = {
							texture = "gfx/interface/component_masks/mask_fade_vertical.dds"
							blend_mode = alphamultiply
							mirror = vertical
						}
					}
					
					scrollbox = {
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding

						blockoverride "scrollbox_margins" {
							margin = { 4 4 }
						}

						blockoverride "scrollbox_content"
						{
							fixedgridbox = {
								layoutpolicy_horizontal = expanding
								datamodel = "[Religion.MakeScope.GetList('black_hand')]"
								addcolumn = 545
								addrow = 95
								setitemsizefromcell = yes

								item = {
									widget_patrons_item = {
										datacontext = "[Scope.GetCharacter]"
									}
								}
							}
							expand = {}
						}
					}
				}
			}
		}
	}
}