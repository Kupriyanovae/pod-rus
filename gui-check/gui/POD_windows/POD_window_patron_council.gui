window = {
	name = "patron_council_view"
	datacontext = "[GetVariableSystem]"
	datacontext = "[GetPlayer]"
	parentanchor = top|right
	allow_outside = yes
	movable = no
	layer = windows_layer
	
	visible = "[And(And(GetVariableSystem.HasValue('pod_sidebar', 'patron_council'), Not(IsRightWindowOpen)), IsSidebarVisibilityValid)]"

	using = Window_Size_MainTab

	state = {
		name = _show
		using = Animation_FadeIn_Quick
		using = Sound_WindowShow_Standard
		using = Window_Position_MainTab

		on_start = "[GetVariableSystem.Set('patron_council_tab_choice','edicts')]"
		on_start = "[GetVariableSystem.Set('patron_council_members_tab_choice', 'seekers')]"
	}

	state = {
		name = _hide
		using = Animation_FadeOut_Quick
		using = Sound_WindowHide_Standard
		using = Window_Position_MainTab_Hide
	}

	margin_widget = {
		size = { 100% 100% }
		margin = { 0 26 }
		margin_right = 13

		widget = {
			size = { 100% 100% }

			### WINDOW CONTENT
			vbox = {
				using = Window_Margins
				ignoreinvisible = yes

				##### HEADER TEXT #####
				widget_header_with_picture = {
					layoutpolicy_horizontal = expanding
					minimumsize = { 0 210 }

					blockoverride "header_text" {
						text = "game_concept_patron_council"
					}

					blockoverride "size" {
						size = { 100% 228 }
					}

					blockoverride "illustration_texture" {
						texture = "gfx/interface/illustrations/window_headers/header_sects.dds"

						using = Mask_Rough_Edges

						modify_texture = {
							texture = "gfx/interface/component_masks/mask_fade_vertical.dds"
							blend_mode = alphamultiply
							mirror = vertical
						}
					}

					blockoverride "button_close"
					{
						onclick = "[GetVariableSystem.Clear('pod_sidebar')]"
						onclick = "[GetVariableSystem.Clear('patron_council_tab_choice')]"
						onclick = "[GetVariableSystem.Clear('patron_council_members_tab_choice')]"
					}

					vbox = {
						margin_top = 42
						margin_bottom = 10

						hbox = {
							spacing = 20

							text_single = {
								text = "PATRON_COUNCIL_WINDOW_TOTAL_INFLUENCE"
							}

							container = {
								text_single = {
									visible = "[GreaterThanOrEqualTo_CFixedPoint(EmptyScope.ScriptValue('patron_council_influence_value'), '(CFixedPoint)0')]"
									text = "PATRON_COUNCIL_WINDOW_INFLUENCE_GAIN"
								}

								text_single = {
									visible = "[LessThan_CFixedPoint(EmptyScope.ScriptValue('patron_council_influence_value'), '(CFixedPoint)0')]"
									text = "PATRON_COUNCIL_WINDOW_INFLUENCE_LOSE"
								}
							}
						}

						spacer = {
							layoutpolicy_vertical = expanding
						}

						text_label_center = {
							text = "PATRON_COUNCIL_WINDOW_MY_STATUS"
						}

						hbox = {
							layoutpolicy_horizontal = expanding
							margin_top = 12
							margin_left = 10
							margin_right = 10
							spacing = 15
							
							hbox = {
								vbox = {
									layoutpolicy_vertical = expanding
									spacing = 3

									hbox = {
										margin_left = 5
										layoutpolicy_horizontal = expanding

										text_label_left = {
											layoutpolicy_horizontal = expanding
											text = "[Localize('POD_chargen.3700.t')]"
											margin_left = 10
										}
									}

									hbox = {
										margin_left = 8

										background = {
											texture = "gfx/lines/line_lifestyles_unavailable.dds"
											margin = { -16 -12 }
											tintcolor = { 0.7 0.5 0.25 1 }
										}

										icon_button_decorative = {
											datacontext = "[GetFaithByKey( 'spring_court' )]"
											size = { 50 50 }
											using = tooltip_below

											icon_button_decorative = {
												size = { 44 44 }
												parentanchor = center
												alwaystransparent = yes
											}

											icon = {
												texture = "[Faith.GetIcon]"
												parentanchor = center
												size = { 32 32 }
												alwaystransparent = yes
											}
										}

										icon_button_decorative = {
											datacontext = "[GetFaithByKey( 'summer_court' )]"
											size = { 50 50 }
											using = tooltip_below

											icon_button_decorative = {
												size = { 44 44 }
												parentanchor = center
												alwaystransparent = yes
											}

											icon = {
												texture = "[Faith.GetIcon]"
												parentanchor = center
												size = { 32 32 }
												alwaystransparent = yes
											}
										}

										icon_button_decorative = {
											datacontext = "[GetFaithByKey( 'autumn_court' )]"
											size = { 50 50 }
											using = tooltip_below

											icon_button_decorative = {
												size = { 44 44 }
												parentanchor = center
												alwaystransparent = yes
											}

											icon = {
												texture = "[Faith.GetIcon]"
												parentanchor = center
												size = { 32 32 }
												alwaystransparent = yes
											}
										}

										icon_button_decorative = {
											datacontext = "[GetFaithByKey( 'winter_court' )]"
											size = { 50 50 }
											using = tooltip_below

											icon_button_decorative = {
												size = { 44 44 }
												parentanchor = center
												alwaystransparent = yes
											}

											icon = {
												texture = "[Faith.GetIcon]"
												parentanchor = center
												size = { 32 32 }
												alwaystransparent = yes
											}
										}
									}
								}
							}

							vbox = {
								layoutpolicy_horizontal = expanding
								layoutpolicy_vertical = expanding
								datacontext = "[GetGlobalVariable('patron_council_philospher_king').GetCharacter]"

								text_label_left = {
									visible = "[Not(Character.IsFemale)]"
									text = "philospher_king_modifier"
									layoutpolicy_horizontal = expanding
									margin_left = 2
								}
								
								text_label_left = {
									visible = "[Character.IsFemale]"
									text = "philospher_queen_modifier"
									layoutpolicy_horizontal = expanding
									margin_left = 2
								}

								expand = {}

								vbox = {
									layoutpolicy_horizontal = expanding

									text_single = {
										layoutpolicy_horizontal = expanding
										text = "[Character.GetUIName]"
										autoresize = no
										align = left
										max_width = 330
									}	

									vbox = {
										name = "info_text"
										layoutpolicy_horizontal = expanding
										layoutpolicy_vertical = expanding

										text_single = {
											visible = "[And( Character.IsAlive, Not( Character.IsImprisoned ) )]"
											layoutpolicy_horizontal = expanding
											text = "CHARACTER_LOCATION_TOOLTIP"
											align = nobaseline
										}

										text_single = {
											visible = "[And( Character.IsAlive, Character.IsImprisoned )]"
											layoutpolicy_horizontal = expanding
											text = "CHARACTER_IMPRISONED_TOOLTIP"
											align = nobaseline
										}

										expand = {}
									}
								}

								expand = {}
							}
						}

						expand = {}
					}

					widget = {
						allow_outside = yes
						size = { 89 98 }
						
						button_group = {
							flowcontainer = {
								margin = { 3 4 }
								direction = vertical
								spacing = -1
								ignoreinvisible = yes

								widget = {
									size = { 86 94 }

									icon = {
										name = "faith_icon"
										parentanchor = center
										size = { 86 86 }
										block "symbol" { texture = "gfx/interface/icons/traits/patron.dds" }
										using = tooltip_se
										tooltip = "game_concept_patron_council_desc"

										state = {
											name = "faith_view_refresh"
											using = Animation_Refresh_FadeOut
										}

										state = {
											using = Animation_Refresh_FadeIn
										}
									}
								}
							}
						}
					}
				}
				
				hbox = {
					name = "patron_council_tabs"
					layoutpolicy_horizontal = expanding

					button_tab = {
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding
						onclick = "[GetVariableSystem.Set('patron_council_tab_choice','members')]"
						down = "[GetVariableSystem.HasValue('patron_council_tab_choice', 'members')]"

						text = "PATRON_COUNCIL_WINDOW_TAB_MEMBERS"
					}

					button_tab = {
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding
						onclick = "[GetVariableSystem.Set('patron_council_tab_choice','edicts')]"
						down = "[GetVariableSystem.HasValue('patron_council_tab_choice', 'edicts')]"

						text = "PATRON_COUNCIL_WINDOW_TAB_EDICTS"
					}
				}
				
				### MEMBERS TAB
				vbox = {
					visible = "[GetVariableSystem.HasValue('patron_council_tab_choice', 'members')]"
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					
					hbox = {
						name = "patron_council_member_tabs"
						layoutpolicy_horizontal = expanding

						button_tab = {
							layoutpolicy_horizontal = expanding
							layoutpolicy_vertical = expanding
							down = "[GetVariableSystem.HasValue('patron_council_members_tab_choice', 'seekers')]"
							onclick = "[GetVariableSystem.Set('patron_council_members_tab_choice','seekers')]"

							text = "PATRON_COUNCIL_WINDOW_TAB_SEEKERS"
						}
						button_tab = {
							layoutpolicy_horizontal = expanding
							layoutpolicy_vertical = expanding
							onclick = "[GetVariableSystem.Set('patron_council_members_tab_choice','vanguard')]"
							down = "[GetVariableSystem.HasValue('patron_council_members_tab_choice', 'vanguard')]"

							text = "PATRON_COUNCIL_WINDOW_TAB_VANGUARD"
						}
						button_tab = {
							layoutpolicy_horizontal = expanding
							layoutpolicy_vertical = expanding
							onclick = "[GetVariableSystem.Set('patron_council_members_tab_choice','austere_conclave')]"
							down = "[GetVariableSystem.HasValue('patron_council_members_tab_choice', 'austere_conclave')]"

							text = "PATRON_COUNCIL_WINDOW_TAB_AUSTERE_CONCLAVE"
						}
					}
					
					### SEEKERS TAB
					vbox = {
						name = "tab_seekers"
						visible = "[GetVariableSystem.HasValue('patron_council_members_tab_choice', 'seekers')]"
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding

						using = Animation_Tab_Switch
					
						background = {
							name = "triangle_background"
							texture = "gfx/interface/illustrations/event_scenes/fp2_garden.dds"
							fittype = end
							alpha = 0.4
							framesize = { 1200 848 }

							using = Mask_Rough_Edges

							modify_texture = {
								texture = "gfx/interface/component_masks/mask_fade_vertical.dds"
								blend_mode = alphamultiply
								mirror = vertical
							}
						}
						
						scrollbox = {
							layoutpolicy_horizontal = expanding
							layoutpolicy_vertical = expanding

							blockoverride "scrollbox_margins" {
								margin = { 4 4 }
							}

							blockoverride "scrollbox_content"
							{
								fixedgridbox = {
									layoutpolicy_horizontal = expanding
									datamodel = "[GetGlobalList('patron_council_seeker')]"
									addcolumn = 545
									addrow = 90
									setitemsizefromcell = yes

									item = {
										widget_patrons_item = {
											datacontext = "[Scope.GetCharacter]"
										}
									}
								}
								expand = {}
							}
						}
					}
					
					### VANGUARD TAB
					vbox = {
						name = "tab_vanguard"
						visible = "[GetVariableSystem.HasValue('patron_council_members_tab_choice', 'vanguard')]"
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding

						using = Animation_Tab_Switch
					
						background = {
							name = "triangle_background"
							texture = "gfx/interface/illustrations/event_scenes/fp2_garden.dds"
							fittype = end
							alpha = 0.4
							framesize = { 1200 848 }

							using = Mask_Rough_Edges

							modify_texture = {
								texture = "gfx/interface/component_masks/mask_fade_vertical.dds"
								blend_mode = alphamultiply
								mirror = vertical
							}
						}
						
						scrollbox = {
							layoutpolicy_horizontal = expanding
							layoutpolicy_vertical = expanding

							blockoverride "scrollbox_margins" {
								margin = { 4 4 }
							}

							blockoverride "scrollbox_content"
							{
								fixedgridbox = {
									layoutpolicy_horizontal = expanding
									datamodel = "[GetGlobalList('patron_council_vanguard')]"
									addcolumn = 545
									addrow = 90
									setitemsizefromcell = yes

									item = {
										widget_patrons_item = {
											datacontext = "[Scope.GetCharacter]"
										}
									}
								}
								expand = {}
							}
						}
					}
					
					### AUSTERE_CONCLAVE TAB
					vbox = {
						name = "tab_austere_conclave"
						visible = "[GetVariableSystem.HasValue('patron_council_members_tab_choice', 'austere_conclave')]"
						enabled = "[GetScriptedGui('austere_conclave_enabled').IsValid(GuiScope.SetRoot( GetPlayer.MakeScope ).End)]"
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding

						using = Animation_Tab_Switch
					
						background = {
							name = "triangle_background"
							texture = "gfx/interface/illustrations/event_scenes/fp2_garden.dds"
							fittype = end
							alpha = 0.4
							framesize = { 1200 848 }

							using = Mask_Rough_Edges

							modify_texture = {
								texture = "gfx/interface/component_masks/mask_fade_vertical.dds"
								blend_mode = alphamultiply
								mirror = vertical
							}
						}
						
						scrollbox = {
							layoutpolicy_horizontal = expanding
							layoutpolicy_vertical = expanding

							blockoverride "scrollbox_margins" {
								margin = { 4 4 }
							}

							blockoverride "scrollbox_content"
							{
								fixedgridbox = {
									layoutpolicy_horizontal = expanding
									datamodel = "[GetGlobalList('patron_council_austere_conclave')]"
									addcolumn = 545
									addrow = 90
									setitemsizefromcell = yes

									item = {
										widget_patrons_item = {
											datacontext = "[Scope.GetCharacter]"
										}
									}
								}
								expand = {}
							}
						}
					}
				}
				
				### EDICTS TAB
				vbox = {
					name = "tab_edicts"
					visible = "[GetVariableSystem.HasValue('patron_council_tab_choice', 'edicts')]"
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding

					using = Animation_Tab_Switch
					
					background = {
						name = "triangle_background"
						texture = "gfx/interface/illustrations/event_scenes/fp2_garden.dds"
						fittype = end
						alpha = 0.4
						framesize = { 1200 848 }

						using = Mask_Rough_Edges

						modify_texture = {
							texture = "gfx/interface/component_masks/mask_fade_vertical.dds"
							blend_mode = alphamultiply
							mirror = vertical
						}
					}
					
					scrollbox = {
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding

						blockoverride "scrollbox_margins" {
							margin = { 4 4 }
						}

						blockoverride "scrollbox_content"
						{
							vbox = {
								spacing = 10
								margin = { 8 8 }

								button_character_edict = {
									datacontext = "[GetScriptedGui( 'patron_council_edict_dreaming_progress' )]"
									blockoverride "edict_title" { text = "patron_council_edict_dreaming_progress" }
									blockoverride "texture" { texture = "gfx/interface/illustrations/decisions/decision_misc.dds" }
								}

								button_character_edict = {
									datacontext = "[GetScriptedGui( 'patron_council_edict_tax' )]"
									blockoverride "edict_title" { text = "patron_council_edict_tax" }
									blockoverride "texture" { texture = "gfx/interface/illustrations/decisions/decision_misc.dds" }
								}

								button_character_edict = {
									datacontext = "[GetScriptedGui( 'patron_council_edict_army' )]"
									blockoverride "edict_title" { text = "patron_council_edict_army" }
									blockoverride "texture" { texture = "gfx/interface/illustrations/decisions/decision_misc.dds" }
								}
							}
							expand = {}
						}
					}
				}
			}
		}
	}
}

types PatronConcil
{
	
	type widget_patrons_item = widget {
		size = { 200 180 }

		vbox = {
			background = {
				using = Background_Area_With_Header
			}

			hbox = {
				layoutpolicy_horizontal = expanding
				spacing = 5

				portrait_head_small = {}

				vbox = {
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					margin_right = 10

					hbox = {
						layoutpolicy_horizontal = expanding
						margin_top = 4

						text_single = {
							layoutpolicy_horizontal = expanding
							text = "[Character.GetUINameNoTooltip]"
							using = Font_Size_Medium
							autoresize = no
							fontsize_min = 13
							align = nobaseline
							max_width = 280
						}

						expand = {}

						hbox_skills_grid_character_model = {}
					}

					hbox = {
						layoutpolicy_horizontal = expanding

						vbox = {
							layoutpolicy_horizontal = expanding

							margin_top = 3

							hbox = {
								layoutpolicy_horizontal = expanding

								text_single = {
									name = "character_relation"
									layoutpolicy_horizontal = expanding
									text = "[Character.GetRelationToString(GetPlayer)]"
									tooltip = "EXTENDED_RELATIONS_TOOLTIP"
									default_format = "#low"
									autoresize = no
									fontsize_min = 13
									align = nobaseline
									max_width = 350
								}

								expand = {}
							}

							vbox = {
								name = "info_text"
								layoutpolicy_horizontal = expanding
								layoutpolicy_vertical = expanding

								text_single = {
									visible = "[And( Character.IsAlive, Not( Character.IsImprisoned ) )]"
									layoutpolicy_horizontal = expanding
									text = "CHARACTER_LOCATION_TOOLTIP"
									align = nobaseline
								}

								text_single = {
									visible = "[And( Character.IsAlive, Character.IsImprisoned )]"
									layoutpolicy_horizontal = expanding
									text = "CHARACTER_IMPRISONED_TOOLTIP"
									align = nobaseline
								}

								expand = {}
							}
						}

						vbox = {
							layoutpolicy_vertical = expanding
							margin_left = 10

							hbox = {
								coa_dynasty_tiny = {
									datacontext = "[Character.GetHouse.GetDynasty]"
									size = { 28 35 }
								}

								vbox = {
									margin_top = 5

									hbox = {
										visible = "[Character.PlayerHasHooksOrHookableSecrets]"
										spacer = {
											size = { 8 0 }
										}
										
										icon = {
											name = "hook"
											size = { 25 25 }
											framesize = { 40 40 }
											texture = "gfx/interface/icons/portraits/hook_secret.dds"

											frame = "[Character.GetHookOrHookableSecretsFrame]"
											tooltip = "[Character.HookTooltip]"
										}
									}
								}
							}
						}
					}
					expand = {}
				}
			}
			expand = {}
		}
	}
}